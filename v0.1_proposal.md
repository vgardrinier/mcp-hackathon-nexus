
## ðŸŽ¯ Hackathon MCP: What to build

step 1: build a simplified MCP server proxy taking inspiration from Nexus

### What We MUST Build 

**Absolute Minimum:**
1. **MCP Proxy Server** - Aggregates tools from end servers
2. **API Endpoints** (2 routes):
   - GET `/api/servers` - Returns available servers (from DB)
   - GET `/api/user/servers` - Returns user's installed servers + configs
3. **Database** - Store server configs and auth tokens (2 tables)
4. **Minimal UI** - Single page with:
   - Server marketplace (list from API)
   - Install button per server
   - Env var input form (for STDIO servers)
   - OAuth button (for HTTP servers)
   - Status display (connected/disconnected)
5. **OAuth Exchange** - Basic OAuth redirect flow

**What We DON'T have to Build:**
- âŒ Full dashboard with routing/navigation
- âŒ Server search/filtering (simple list only)
- âŒ User management (single hardcoded user)
- âŒ Webhooks (MCP server polls API)
- âŒ Token refresh (manual only)
- âŒ Error handling UI (console logs only)
- âŒ Multiple pages/routes (single page app)
- âŒ Server discovery (hardcode servers in DB)

### MVP Implementation

**Database (2 tables only):**
```sql
CREATE TABLE mcp_servers (
  id UUID PRIMARY KEY,
  name TEXT,
  config JSONB  -- {transport, command/url, accessToken}
);

CREATE TABLE user_servers (
  user_id TEXT PRIMARY KEY,  -- Hardcode: 'default'
  server_ids UUID[]  -- Array of installed server IDs
);
```

**API (2 endpoints):**
```typescript
// Marketplace: Available servers
GET /api/servers
// Returns: [{id, name, description, transport}]

// User's installed servers with configs
GET /api/user/servers?user_id=default
// Returns: [{id, config, accessToken, envVars}]
```

**MCP Server:**
- Poll API every 30s
- Connect to returned servers
- Aggregate tools (simple namespace: `server0_tool`, `server1_tool`)
- Route tool calls

**OAuth (Manual Script):**
```bash
# One-time: Get token manually
curl -X POST https://provider.com/oauth/token ...
# Store in database manually
```

**MVP Stack:**
- Express API (2 routes)
- PostgreSQL (2 tables)
- MCP SDK (proxy server)
- Single HTML page with:
  - Server marketplace (fetches from API)
  - Install button â†’ calls API
  - Env var form â†’ saves to DB
  - OAuth button â†’ redirects to provider
- Basic OAuth redirect callback


## Data Flow

### User Installs Server

```
1. User clicks "Install" in dashboard
   â†“
2. POST /api/user/mcp/servers/[id]
   â†“
3. Insert into mcp_server_users table
   â†“
4. Check if auth required
   â†“
5. If OAuth: Show "Authenticate" button
   If Env Vars: Show env var form
   â†“
6. User completes auth
   â†“
7. POST /api/external/server (webhook)
   â†“
8. MCP server receives notification
   â†“
9. MCP server fetches updated server list
   â†“
10. MCP server connects to end server
   â†“
11. Tools become available
```

### Tool Call Flow

```
1. Client calls tool: github_0_search_repos
   â†“
2. Nexus MCP receives call
   â†“
3. Parses namespace: github_0 â†’ server ID mapping
   â†“
4. Routes to GitHub EndServer instance
   â†“
5. EndServer calls GitHub MCP server
   â†“
6. GitHub returns result
   â†“
7. EndServer returns to Nexus
   â†“
8. Proxy returns to client 
```

---

## Authentication Architecture

### OAuth Flow (Streamable HTTP)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚    â”‚ Dashboardâ”‚    â”‚ Provider â”‚    â”‚   MCP   â”‚
â”‚ Browser â”‚    â”‚  Server  â”‚    â”‚ (Notion) â”‚    â”‚ Server  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚              â”‚                â”‚                â”‚
     â”‚ 1. Click Authâ”‚                â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚ 2. Get Auth URLâ”‚                â”‚
     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚              â”‚ 3. Auth URL    â”‚                â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
     â”‚ 4. Redirect  â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
     â”‚ 5. Authorize â”‚                â”‚                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚ 6. Redirect  â”‚                â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
     â”‚ 7. Callback  â”‚                â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
     â”‚              â”‚ 8. Exchange   â”‚                â”‚
     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚              â”‚ 9. Tokens      â”‚                â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
     â”‚              â”‚ 10. Store     â”‚                â”‚
     â”‚              â”‚     tokens     â”‚                â”‚
     â”‚              â”‚                â”‚                â”‚
     â”‚              â”‚ 11. Notify MCP â”‚                â”‚
     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚              â”‚                â”‚                â”‚
     â”‚              â”‚                â”‚ 12. Fetch      â”‚
     â”‚              â”‚                â”‚     servers    â”‚
     â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚              â”‚                â”‚                â”‚
     â”‚              â”‚                â”‚ 13. Connect   â”‚
     â”‚              â”‚                â”‚     to server  â”‚
     â”‚              â”‚                â”‚                â”‚
```

### Environment Variables (STDIO)

```
1. User enters env vars in dashboard
2. Values stored in mcp_server_environment_vars_users
3. MCP server fetches servers via API
4. MCP server gets env vars for each server
5. When starting subprocess, injects env vars:
   process.env.GITHUB_TOKEN = userValue
6. Subprocess has access to env vars
```

---
