FROM node:20-bookworm-slim

WORKDIR /app

# Enable pnpm via corepack
RUN corepack enable

# Pre-install dependencies separately for better cache reuse
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml tsconfig.base.json ./
COPY apps/dashboard/package.json apps/dashboard/
RUN pnpm install --frozen-lockfile

# Bring in the rest of the source
COPY . .

ENV NODE_ENV=development

EXPOSE 3001

# MCP HTTP server entrypoint
CMD ["pnpm", "dev:mcp:http"]
